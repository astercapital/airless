
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../core-infrastructure/">
      
      
        <link rel="next" href="../multistep/">
      
      
      <link rel="icon" href="../../../assets/images/logo_resized.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Simple Workflow - Airless</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#set-up-local-environment-install-airless-packages" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Airless" class="md-header__button md-logo" aria-label="Airless" data-md-component="logo">
      
  <img src="../../../assets/images/logo_white_resized.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Airless
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Simple Workflow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Airless

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../quickstart/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api/airless-core/operator/" class="md-tabs__link">
          
  
  Api Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Airless" class="md-nav__button md-logo" aria-label="Airless" data-md-component="logo">
      
  <img src="../../../assets/images/logo_white_resized.png" alt="logo">

    </a>
    Airless
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Airless
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Airless
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../infrastucture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multistep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Step Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Providers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Providers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Google Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Google Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Simple Workflow
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Simple Workflow
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-local-environment-install-airless-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Set up Local Environment &amp; Install Airless Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookpy" class="md-nav__link">
    <span class="md-ellipsis">
      hook.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operatorpy" class="md-nav__link">
    <span class="md-ellipsis">
      operator.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mainpy" class="md-nav__link">
    <span class="md-ellipsis">
      main.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirementstxt" class="md-nav__link">
    <span class="md-ellipsis">
      requirements.txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#env" class="md-nav__link">
    <span class="md-ellipsis">
      .env
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Explanation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformvariablestf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/variables.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformmaintf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/main.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformfunctiontf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/function.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-and-run" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy and Run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-example" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multistep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multistep Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Api Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Api Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            airless-core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-core/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-core/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-core/service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-core/dto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-core/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-google-cloud-core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            airless-google-cloud-core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-core/core/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    pubsub
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            pubsub
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-core/pubsub/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-google-cloud-storage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            airless-google-cloud-storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-storage/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-storage/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-google-cloud-bigquery
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            airless-google-cloud-bigquery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-bigquery/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-bigquery/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-google-cloud-secret-manager
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            airless-google-cloud-secret-manager
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-secret-manager/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-google-cloud-vertexai
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            airless-google-cloud-vertexai
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-google-cloud-vertexai/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-slack
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            airless-slack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-slack/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-slack/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-email
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            airless-email
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-email/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-email/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-captcha
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            airless-captcha
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-captcha/providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    providers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    airless-pdf
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            airless-pdf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/airless-pdf/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-local-environment-install-airless-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Set up Local Environment &amp; Install Airless Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookpy" class="md-nav__link">
    <span class="md-ellipsis">
      hook.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operatorpy" class="md-nav__link">
    <span class="md-ellipsis">
      operator.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mainpy" class="md-nav__link">
    <span class="md-ellipsis">
      main.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirementstxt" class="md-nav__link">
    <span class="md-ellipsis">
      requirements.txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#env" class="md-nav__link">
    <span class="md-ellipsis">
      .env
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Explanation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformvariablestf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/variables.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformmaintf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/main.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-configuration-terraformfunctiontf" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Configuration (terraform/function.tf)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-and-run" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy and Run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-example" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Simple Workflow</h1>

<p>This quickstart guides you through installing the <code>airless-core</code> package and its GCP dependencies, setting up a basic workflow that consults a weather API and logs the response, and deploying it as a Cloud Function on Google Cloud Platform (GCP) using Terraform.</p>
<p>This quickstart assumes you have:</p>
<ul>
<li>A local IDE (VS Code, PyCharm, etc.) with Python 3.9+.</li>
<li>Terminal access.</li>
<li>A Google Cloud Platform account with billing enabled.</li>
<li>The <code>gcloud</code> CLI installed and configured (<a href="https://cloud.google.com/sdk/docs/install">link</a>).</li>
<li>Terraform installed (<a href="https://developer.hashicorp.com/terraform/install">link</a>).</li>
<li>Core infrastructure module already defined. (<a href="../core-infrastructure/">link</a>)</li>
</ul>
<h2 id="set-up-local-environment-install-airless-packages">Set up Local Environment &amp; Install Airless Packages</h2>
<p>First, set up a local Python environment to manage dependencies for developing and packaging the function source code.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">uv</label><label for="__tabbed_1_2">pip + venv</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Create a bare virtual environment (no pyproject.toml needed for this simple example)</span>
uv<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate<span class="w"> </span><span class="c1"># Or .\venv\Scripts\activate.bat / Activate.ps1 on Windows</span>
<span class="c1"># Install necessary packages</span>
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>airless-core<span class="w"> </span>airless-google-cloud-core<span class="w"> </span>airless-google-cloud-pubsub<span class="w"> </span>functions-framework<span class="w"> </span>requests<span class="w"> </span>google-cloud-pubsub
<span class="c1"># Generate requirements.txt for Cloud Function deployment</span>
uv<span class="w"> </span>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="c1"># Activate venv in Mac / Linux</span>
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
<span class="c1"># Windows CMD: .venv\Scripts\activate.bat</span>
<span class="c1"># Windows PowerShell: .venv\Scripts\Activate.ps1</span>
pip<span class="w"> </span>install<span class="w"> </span>airless-core<span class="w"> </span>airless-google-cloud-core<span class="w"> </span>airless-google-cloud-pubsub<span class="w"> </span>functions-framework<span class="w"> </span>requests<span class="w"> </span>google-cloud-pubsub
pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>
</div>
</div>
</div>
<h2 id="project-structure">Project Structure</h2>
<p>Create the following directory structure for your project:</p>
<div class="highlight"><pre><span></span><code>.
├── hook
│   └── api.py         # Code to interact with the external weather API
├── operator
│   └── weather.py     # Business logic using the hook
├── main.py            # GCP Cloud Function entry point
├── requirements.txt   # Python dependencies
├── main.tf            # Main Terraform configuration (source packaging, GCS, Scheduler)
├── function.tf        # Terraform configuration for the Cloud Function &amp; Pub/Sub Topic
├── variables.tf       # Terraform variable definitions
├── Makefile           # Helper commands for deployment and testing
└── .env               # Environment variables (primarily for Makefile/local use)
</code></pre></div>
<p>Create the necessary folders and empty files:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>hook<span class="w"> </span>operator
touch<span class="w"> </span>hook/api.py<span class="w"> </span>operator/weather.py<span class="w"> </span>main.py<span class="w"> </span>main.tf<span class="w"> </span><span class="k">function</span>.tf<span class="w"> </span>variables.tf<span class="w"> </span>Makefile<span class="w"> </span>.env
<span class="c1"># requirements.txt should already exist from the previous step</span>
</code></pre></div>
<h2 id="hookpy">hook.py</h2>
<p>This file defines the <code>ApiHook</code>, responsible for fetching data from the external Open-Meteo weather API. It inherits from <code>airless.core.hook.BaseHook</code>.</p>
<div class="highlight"><span class="filename">hook/api.py</span><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">airless.core.hook</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseHook</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ApiHook</span><span class="p">(</span><span class="n">BaseHook</span><span class="p">):</span> <span class="c1"># (1)!</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple hook to simulate fetching weather data.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the WeatherApiHook.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.open-meteo.com/v1/forecast&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the current temperature for a given city.</span>

<span class="sd">        Args:</span>
<span class="sd">            lat (float): The latitude of the city.</span>
<span class="sd">            lon (float): The longitude of the city.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The current temperature in Celsius.</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.exceptions.RequestException: If the API request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
            <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span>
            <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="s1">&#39;temperature_2m&#39;</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span> <span class="c1"># (2)!</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># Add a timeout</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># (3)!</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (4)!</span>

            <span class="n">temperature</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="s1">&#39;temperature_2m&#39;</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">temperature</span>
</code></pre></div>
<ol>
<li>Hooks encapsulate interactions with external systems and inherit from <code>BaseHook</code>.</li>
<li>Using <code>requests.Session()</code> enhances performance through connection reuse and provides configuration options.</li>
<li><code>response.raise_for_status()</code> checks for HTTP errors (4xx, 5xx) and raises an exception if one occurred. This allows Airflow's error handling (or the base operator's error routing) to catch it.</li>
<li><code>BaseHook</code> provides a pre-configured logger (<code>self.logger</code>).</li>
</ol>
<h2 id="operatorpy">operator.py</h2>
<p>This file defines the <code>WeatherOperator</code>, which contains the core logic. It uses the <code>ApiHook</code> to fetch data and logs the result. For GCP deployment, it inherits from <code>airless.google.cloud.core.operator.GoogleBaseEventOperator</code>, which handles parsing the incoming Cloud Event.</p>
<div class="highlight"><span class="filename">operator/weather.py</span><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">airless.google.cloud.core.operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">GoogleBaseEventOperator</span> <span class="c1"># (1)!</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">airless.core.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config</span> <span class="c1"># To read environment variables if needed later</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hook.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApiHook</span>


<span class="k">class</span><span class="w"> </span><span class="nc">WeatherOperator</span><span class="p">(</span><span class="n">GoogleBaseEventOperator</span><span class="p">):</span> <span class="c1"># (2)!</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple operator to fetch weather data triggered by a Cloud Event.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the WeatherOperator.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_hook</span> <span class="o">=</span> <span class="n">ApiHook</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># (3)!</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define which method to call based on the request type from the event data.&quot;&quot;&quot;</span>
        <span class="n">request_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;request_type&#39;</span><span class="p">)</span> <span class="c1"># Use .get for safer access</span>

        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Log a warning or raise a more specific error if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request type &#39;</span><span class="si">{</span><span class="n">request_type</span><span class="si">}</span><span class="s2">&#39; not implemented or missing in message data.&quot;</span><span class="p">)</span>
            <span class="c1"># Optionally raise an exception to trigger error handling/retry</span>
            <span class="c1"># raise ValueError(f&quot;Request type &#39;{request_type}&#39; not implemented&quot;)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch the current temperature for a given city from message data.&quot;&quot;&quot;</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing &#39;lat&#39; or &#39;lon&#39; in message data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Decide if this should be a hard failure</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing latitude or longitude in input data&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_hook</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully fetched temperature for (</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">temperature</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">)</span> <span class="c1"># (4)!</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get temperature for (</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Re-raise the exception to let the base operator handle error routing</span>
            <span class="k">raise</span>
</code></pre></div>
<ol>
<li>Import the base operator designed for GCP Cloud Events.</li>
<li>Inherit from <code>GoogleBaseEventOperator</code>. This base class handles parsing the incoming <code>cloud_event</code> in <code>main.py</code> and calls the <code>execute</code> method with extracted <code>data</code> and <code>topic</code>.</li>
<li>The <code>execute</code> method receives the payload (<code>data</code>) from the Pub/Sub message and the <code>topic</code> name.</li>
<li>Use the built-in <code>self.logger</code> for logging. <code>INFO</code> level is often more appropriate for successful execution steps than <code>DEBUG</code>.</li>
</ol>
<h2 id="mainpy">main.py</h2>
<p>This is the entry point for the GCP Cloud Function. It uses the <code>functions_framework</code> to handle the incoming Cloud Event trigger (from Pub/Sub), dynamically imports the specified operator, instantiates it, and runs it.</p>
<div class="highlight"><span class="filename">main.py</span><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">functions_framework</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">airless.core.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config</span>

<span class="c1"># Dynamically import the operator based on environment variable</span>
<span class="n">exec</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;OPERATOR_IMPORT&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> as OperatorClass&#39;</span><span class="p">)</span> <span class="c1"># (1)!</span>

<span class="nd">@functions_framework</span><span class="o">.</span><span class="n">cloud_event</span> <span class="c1"># (2)!</span>
<span class="k">def</span><span class="w"> </span><span class="nf">route</span><span class="p">(</span><span class="n">cloud_event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cloud Function entry point triggered by a Pub/Sub event.</span>
<span class="sd">    Dynamically routes the event to the appropriate Airless operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Instantiate the dynamically loaded operator class</span>
    <span class="n">operator_instance</span> <span class="o">=</span> <span class="n">OperatorClass</span><span class="p">()</span>
    <span class="c1"># Run the operator with the incoming event data</span>
    <span class="n">operator_instance</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cloud_event</span><span class="p">)</span> <span class="c1"># (3)!</span>
</code></pre></div>
<ol>
<li><code>exec(f'{get_config("OPERATOR_IMPORT")} as OperatorClass')</code> dynamically imports the operator class based on the <code>OPERATOR_IMPORT</code> environment variable (defined in Terraform). This makes the <code>main.py</code> reusable.</li>
<li><code>@functions_framework.cloud_event</code> decorator registers this function to handle Cloud Events.</li>
<li><code>operator_instance.run(cloud_event)</code> is called. The <code>GoogleBaseEventOperator</code>'s <code>run</code> method parses the <code>cloud_event</code> (decoding the Pub/Sub message data) and then calls the <code>execute</code> method you defined in <code>WeatherOperator</code> with the extracted <code>data</code> and <code>topic</code>.</li>
</ol>
<h2 id="requirementstxt">requirements.txt</h2>
<p>This file lists the Python dependencies needed by the Cloud Function. It's generated by <code>uv pip freeze</code> or <code>pip freeze</code>.</p>
<div class="highlight"><span class="filename">requirements.txt</span><pre><span></span><code>airless-google-cloud-core==&lt;version&gt;
# Add any other direct or transitive dependencies listed by freeze
</code></pre></div>
<p><em>(Note: Replace <code>&lt;version&gt;</code> with the actual versions installed in your environment)</em></p>
<h2 id="env">.env</h2>
<p>Create a <code>.env</code> file in the root directory to store configuration, primarily for the Makefile commands. <strong>Remember to add this file to your <code>.gitignore</code>!</strong></p>
<div class="highlight"><span class="filename">.env</span><pre><span></span><code># Environment Name (used for naming resources)
ENV=dev

# Logging Level for local testing (Cloud Function level set in Terraform)
LOG_LEVEL=DEBUG

# --- GCP Configuration ---
# Replace with your actual GCP Project ID
GCP_PROJECT=&quot;your-gcp-project-id&quot;
QUEUE_TOPIC_ERROR=&quot;dev-airless-error&quot;
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ensure this file is added to your <code>.gitignore</code> to avoid committing sensitive information like secrets if applicable.</p>
</div>
<p>Fill in your <code>GCP_PROJECT</code>, <code>GCP_REGION</code></p>
<h2 id="makefile">Makefile</h2>
<p>Create a <code>Makefile</code> to simplify deployment and testing commands.</p>
<div class="admonition warning">
<p class="admonition-title">Makefile Indentation</p>
<p>Remember that Makefiles use <strong>tabs</strong> for indentation, not spaces.</p>
</div>
<div class="highlight"><span class="filename">Makefile</span><pre><span></span><code><span class="nf">run</span><span class="o">:</span>
<span class="w">  </span>@python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from operator.weather import WeatherOperator; WeatherOperator().execute({&#39;request_type&#39;: &#39;temperature&#39;, &#39;lat&#39;: 51.5074, &#39;lon&#39;: -0.1278})&quot;</span>
</code></pre></div>
<p>This Makefile provides convenient targets:</p>
<ul>
<li><code>make run</code>: Runs the operator locally.</li>
</ul>
<h2 id="error-handling-explanation">Error Handling Explanation</h2>
<p>Airless on GCP typically utilizes a centralized error handling mechanism. The <code>GoogleBaseEventOperator</code> is designed to automatically catch uncaught exceptions that occur within your <code>execute</code> method (or methods called by it, like <code>api_hook.get_temperature</code>).</p>
<p>When an exception occurs, the base operator formats an error message (including the original message data, topic, and exception details) and publishes it to a designated error Pub/Sub topic. This error topic's name is configured via the <code>QUEUE_TOPIC_ERROR</code> environment variable, which we will set in the Terraform configuration (<code>function.tf</code>).</p>
<p>This means you generally don't need explicit <code>try...except</code> blocks for <em>routing</em> errors within your <code>execute</code> method, unless you want to perform specific cleanup or logging before letting the error propagate. The infrastructure for this error topic (and potentially a separate function to consume from it for alerts or retries) needs to exist and be specified for the main function to use. We define the <code>QUEUE_TOPIC_ERROR</code> variable in <code>variables.tf</code> and pass it to the function in <code>function.tf</code>.</p>
<h2 id="terraform-configuration-terraformvariablestf">Terraform Configuration (<code>terraform/variables.tf</code>)</h2>
<p>This file defines the input variables for your Terraform configuration, allowing for customization without changing the main code.</p>
<div class="highlight"><span class="filename">terraform/variables.tf</span><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;project_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;The GCP project ID.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;region&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;The GCP region to deploy resources in.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-central1&quot;</span><span class="c1"> # Or your preferred region</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;env&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod).&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;log_level&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Logging level for the Cloud Function.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the GCS bucket to store Cloud Function source code.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="c1">  # Example: default = &quot;your-prefix-cloud-functions-source&quot;</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;pubsub_topic_error_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the Pub/Sub topic for routing function errors.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev-airless-error&quot;</span><span class="c1"> # Example, adjust as needed</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Base name for the Cloud Function.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;weather-api&quot;</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;source_archive_exclude&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Files/directories to exclude from the source code archive.&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span>
<span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;.venv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;.git&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;.terraform&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;__pycache__&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;*.pyc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;*.zip&quot;</span><span class="c1"> # Exclude the output zip itself</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>This file defines variables like project ID, region, environment name, bucket name for source code, error topic name, and function settings. Defaults are provided for convenience.</p>
<h2 id="terraform-configuration-terraformmaintf">Terraform Configuration (<code>terraform/main.tf</code>)</h2>
<p>This file sets up the Google provider, creates the source code archive, uploads it to GCS, and defines the Cloud Scheduler job to trigger the workflow periodically.</p>
<div class="highlight"><span class="filename">terraform/main.tf</span><pre><span></span><code><span class="c1"># Archive the source code directory into a zip file</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">&quot;archive_file&quot;</span><span class="w"> </span><span class="nv">&quot;source&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;zip&quot;</span>
<span class="w">  </span><span class="na">source_dir</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/&quot;</span><span class="c1"> # Zips the current directory</span>
<span class="w">  </span><span class="na">output_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/tmp/${var.env}-${var.function_name}-source.zip&quot;</span>
<span class="w">  </span><span class="na">excludes</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.source_archive_exclude</span>

<span class="c1">  # Include necessary files/dirs explicitly if source_dir is broader</span>
<span class="c1">  # For this structure, source_dir = &quot;.&quot; works fine with excludes.</span>
<span class="p">}</span>

<span class="c1"># Upload the zipped source code to GCS</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_storage_bucket_object&quot;</span><span class="w"> </span><span class="nv">&quot;zip&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.env}-${var.function_name}-src-${data.archive_file.source.output_md5}.zip&quot;</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_storage_bucket.function_source_bucket.name</span><span class="c1"> # Use the created bucket name</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.source.output_path</span>
<span class="p">}</span>
</code></pre></div>
<p>This defines the packaging (<code>archive_file</code>), the GCS bucket (<code>google_storage_bucket</code>), the upload (<code>google_storage_bucket_object</code>), and the trigger (<code>google_cloud_scheduler_job</code>). It depends on resources defined in <code>function.tf</code>.</p>
<h2 id="terraform-configuration-terraformfunctiontf">Terraform Configuration (<code>terraform/function.tf</code>)</h2>
<p>This file defines the Pub/Sub topic that acts as the trigger and the Cloud Function resource itself.</p>
<div class="highlight"><span class="filename">terraform/function.tf</span><pre><span></span><code><span class="c1"># Pub/Sub Topic to trigger the function</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_pubsub_topic&quot;</span><span class="w"> </span><span class="nv">&quot;main_topic&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.env}-${var.function_name}&quot;</span>
<span class="p">}</span>

<span class="c1"># The Cloud Function resource</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_cloudfunctions2_function&quot;</span><span class="w"> </span><span class="nv">&quot;main_function&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.env}-${var.function_name}&quot;</span>
<span class="w">  </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.region</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Airless function to fetch weather data from API&quot;</span>

<span class="w">  </span><span class="nb">build_config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">runtime</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python312&quot;</span><span class="c1"> # Or python310, python311, python312</span>
<span class="w">    </span><span class="na">entry_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;route&quot;</span><span class="c1">    # Matches the function name in main.py</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">storage_source</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_storage_bucket_object.zip.bucket</span><span class="c1"> # Get bucket from the uploaded object</span>
<span class="w">        </span><span class="na">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_storage_bucket_object.zip.name</span><span class="c1">   # Get object name from the uploaded object</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">service_config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">max_instance_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="c1"> # Limit concurrency</span>
<span class="w">    </span><span class="na">available_memory</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;256Mi&quot;</span>
<span class="w">    </span><span class="na">timeout_seconds</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
<span class="c1">    # Define environment variables needed by the function and airless core/gcp libs</span>
<span class="w">    </span><span class="nb">environment_variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">ENV</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.env</span>
<span class="w">      </span><span class="na">LOG_LEVEL</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.log_level</span>
<span class="w">      </span><span class="na">GCP_PROJECT</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">var.project_id</span><span class="c1"> # Airless GCP libs might need this</span>
<span class="w">      </span><span class="na">GCP_REGION</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">var.region</span><span class="c1">     # Airless GCP libs might need this</span>
<span class="w">      </span><span class="na">OPERATOR_IMPORT</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;from operator.weather import WeatherOperator&quot;</span>
<span class="w">      </span><span class="na">QUEUE_TOPIC_ERROR</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.pubsub_topic_error_name</span><span class="c1"> # For base operator error routing</span>
<span class="c1">      # Add any other specific env vars your operator/hook might need</span>
<span class="w">    </span><span class="p">}</span>
<span class="c1">    # ingress_settings               = &quot;ALLOW_ALL&quot; # Default - Allow public access if needed (not for PubSub trigger)</span>
<span class="c1">    # all_traffic_on_latest_revision = true</span>
<span class="w">  </span><span class="p">}</span>

<span class="c1">  # Configure the trigger (Pub/Sub topic)</span>
<span class="w">  </span><span class="nb">event_trigger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">trigger_region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.region</span><span class="c1"> # Can differ from function region if needed</span>
<span class="w">    </span><span class="na">event_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;google.cloud.pubsub.topic.v1.messagePublished&quot;</span>
<span class="w">    </span><span class="na">pubsub_topic</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">google_pubsub_topic.main_topic.id</span>
<span class="w">    </span><span class="na">retry_policy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;RETRY_POLICY_RETRY&quot;</span><span class="c1"> # Retry on failure</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Cloud Scheduler job to periodically trigger the function via Pub/Sub</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_cloud_scheduler_job&quot;</span><span class="w"> </span><span class="nv">&quot;trigger&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.env}-${var.function_name}-trigger&quot;</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Periodically trigger the weather API function&quot;</span>
<span class="w">  </span><span class="na">schedule</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*/15 * * * *&quot;</span><span class="c1"> # Trigger every 15 minutes for demo</span>
<span class="w">  </span><span class="na">time_zone</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;America/Sao_Paulo&quot;</span>

<span class="w">  </span><span class="nb">pubsub_target</span><span class="w"> </span><span class="p">{</span>
<span class="c1">    # google_pubsub_topic.main_topic is defined in function.tf</span>
<span class="w">    </span><span class="na">topic_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_pubsub_topic.main_topic.id</span>
<span class="c1">    # Message payload expected by the operator&#39;s execute method</span>
<span class="c1">    # Example: New York City</span>
<span class="w">    </span><span class="na">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">      </span><span class="s2">&quot;request_type&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;lat&quot;</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">40.7128</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;lon&quot;</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="err">-</span><span class="nv">74.0060</span>
<span class="w">    </span><span class="p">}))</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This defines the <code>google_pubsub_topic</code> and the <code>google_cloudfunctions2_function</code>, linking it to the topic via <code>event_trigger</code> and configuring its source code, runtime, environment variables, and other settings.</p>
<h2 id="deploy-and-run">Deploy and Run</h2>
<ol>
<li>
<p><strong>Initialize Terraform:</strong>
    <div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>init
</code></pre></div></p>
</li>
<li>
<p><strong>Review Plan (Optional but Recommended):</strong>
    <div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>plan
</code></pre></div>
    Check the output to see what resources Terraform will create.</p>
</li>
<li>
<p><strong>Deploy Resources:</strong>
    <div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>apply
</code></pre></div>
    This command will package your code, upload it, and create the GCS Bucket, Pub/Sub topic, Cloud Function, and Cloud Scheduler job on GCP. It might take a few minutes.</p>
</li>
<li>
<p><strong>Test Manually (Optional):</strong>
    You can trigger the function immediately without waiting for the scheduler:
    <div class="highlight"><pre><span></span><code>gcloud<span class="w"> </span>pubsub<span class="w"> </span>topics<span class="w"> </span>publish<span class="w"> </span>dev-weather-api<span class="w"> </span>--message<span class="w"> </span><span class="s1">&#39;{&quot;request_type&quot;: &quot;temperature&quot;, &quot;lat&quot;: 51.5074, &quot;lon&quot;: -0.1278}&#39;</span>
</code></pre></div>
    Check the Cloud Function logs in the GCP Console to see the output and verify the temperature was logged.</p>
</li>
<li>
<p><strong>Monitor:</strong> The Cloud Scheduler job is configured (by default) to trigger the function every 15 minutes. You can monitor its executions and the function logs in the GCP Console.</p>
</li>
</ol>
<h2 id="clean-up">Clean Up</h2>
<p>To remove all the GCP resources created by this example, run:</p>
<p><div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>destroy
</code></pre></div>
Confirm the prompt to delete the resources.</p>
<h2 id="simple-example">Simple Example</h2>
<p>Only return a message to pubsub but now using GCP pubsub.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.instant.preview", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>